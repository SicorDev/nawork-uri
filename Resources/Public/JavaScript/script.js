"use strict";String.prototype.format=function(){var t=arguments,e=0;return this.replace(/(%(s|d))/g,function(a){var n;switch(a){case"%d":n=parseInt(t[e]),isNaN(n)&&(n=0);break;default:n=t[e]}return++e,n})},Number.prototype.forceInRange=function(t,e){return this<t?t:this>e?e:this},function(t){var e=function(e,a){this.$element=t(e),this.options=t.extend({},this.options,a||{}),this.init()};e.prototype={$element:null,options:{inputChangeTimeout:300},filter:null,userSettings:null,ajaxUrl:null,$tableInner:null,controls:{$first:null,$previous:null,$numberOfRecords:null,$page:null,$pagesMax:null,$next:null,$last:null},urls:{load:null,lock:null,unlock:null,delete:null,deleteSelected:null},state:{ajaxCall:null,inputChangeTimeout:null,maxPages:1,selectedRecords:[],lastClickedRecord:null},init:function(){this.filter=this.$element.data("filter"),this.userSettings=this.$element.data("settings"),this.urls.load=this.$element.data("ajaxUrlLoad"),this.urls.lock=this.$element.data("ajaxUrlLock"),this.urls.unlock=this.$element.data("ajaxUrlUnlock"),this.urls.delete=this.$element.data("ajaxUrlDelete"),this.urls.deleteSelected=this.$element.data("ajaxUrlDeleteSelected"),this.$tableInner=this.$element.find(".urlTable__body__inner"),this.controls.$first=this.$element.find(".js-paginationFirst"),this.controls.$previous=this.$element.find(".js-paginationPrevious"),this.controls.$numberOfRecords=this.$element.find(".js-numberOfRecords"),this.controls.$page=this.$element.find(".js-page"),this.controls.$pagesMax=this.$element.find(".js-pagesMax"),this.controls.$next=this.$element.find(".js-paginationNext"),this.controls.$last=this.$element.find(".js-paginationLast"),this.controls.$reload=this.$element.find(".js-reload"),this.initListener(),this.initContextMenuEvents(),this.loadUrls()},initListener:function(){var e=this;t('[name="DomainMenu"]').change(function(){var a=t(this.options[this.selectedIndex]).data("domain");a&&!isNaN(a)&&a!==e.filter.domain&&(e.filter.domain=a,e.loadUrls())}),t('[name="TypesMenu[]"]').change(function(){var a=t(this).data("type");if(a&&a.length>0){if(t(this).is(":checked")&&e.filter.types.indexOf(a)<0)e.filter.types.push(a);else if(!t(this).is(":checked")&&e.filter.types.indexOf(a)>-1){var n=e.filter.types.indexOf(a);isNaN(n)||e.filter.types.splice(n,1)}e.loadUrls()}}),t('[name="LanguageMenu"]').change(function(){var a=parseInt(t(this.options[this.selectedIndex]).data("language"));if(!isNaN(a)){switch(a){case-1:e.filter.ignoreLanguage=1,e.filter.language=null;break;case 0:e.filter.ignoreLanguage=0,e.filter.language=null;break;default:e.filter.ignoreLanguage=0,e.filter.language=a}e.loadUrls()}}),t('[name="ScopeMenu"]').change(function(){var a=t(this.options[this.selectedIndex]).data("scope");a&&a.length>0&&a!==e.filter.scope&&(e.filter.scope=a,e.loadUrls())}),this.$element.find(".js-icon").click(function(){var e=t(this);e.toggleClass("isVisible"),e.siblings(".js-icon").toggleClass("isVisible");var a=e.siblings(".urlTable__column__search").toggleClass("isVisible");a.hasClass("isVisible")?a[0].focus():(a.val(""),a.trigger("change"))}),this.$element.find(".js-pathInput").on("customChange",function(){var a=t(this);null!==e.state.inputChangeTimeout&&clearTimeout(e.state.inputChangeTimeout),setTimeout(function(){a.val()!==e.filter.path&&(e.filter.path=a.val(),e.loadUrls())},e.options.inputChangeTimeout)}).keyup(function(){t(this).trigger("customChange")}).change(function(){t(this).trigger("customChange")}),this.$element.find(".js-parametersInput").on("customChange",function(){var a=t(this);null!==e.state.inputChangeTimeout&&clearTimeout(e.state.inputChangeTimeout),setTimeout(function(){a.val()!==e.filter.parameters&&(e.filter.parameters=a.val(),e.loadUrls())},e.options.inputChangeTimeout)}).keyup(function(){t(this).trigger("customChange")}).change(function(){t(this).trigger("customChange")}),this.controls.$first.click(function(){t(this).hasClass("disabled")||(e.filter.offset=0,e.updatePagination(this.filter.offset),e.loadUrls())}),this.controls.$previous.click(function(){t(this).hasClass("disabled")||(e.filter.offset=Math.min(0,e.filter.offset-1),e.updatePagination(this.filter.offset),e.loadUrls())}),this.controls.$previous.click(function(){t(this).hasClass("disabled")||(e.filter.offset=Math.max(e.state.maxPages-1,e.filter.offset+1),e.updatePagination(this.filter.offset),e.loadUrls())}),this.controls.$previous.click(function(){t(this).hasClass("disabled")||(e.filter.offset=e.state.maxPages-1,e.updatePagination(this.filter.offset),e.loadUrls())}),this.controls.$page.keyup(function(){null!==e.state.inputChangeTimeout&&clearTimeout(e.state.inputChangeTimeout),e.state.inputChangeTimeout=setTimeout(function(){var t=parseInt(e.controls.$page.val());if(!isNaN(t)){var a=t.forceInRange(1,e.state.maxPages);a!=e.filter.offset+1?e.filter.offset=a-1:e.updatePagination(e.filter.offset+1)}},e.options.inputChangeTimeout)}),this.controls.$reload.click(function(){e.loadUrls()})},initTableRowSelect:function(){var e=this;this.state.lastClickedRecord=null,this.$tableInner.find(".urlTable__row").each(function(e,a){t(a).data("rowIndex",e)}).click(function(a){var n=t(this);if(a.ctrlKey===!1&&a.metaKey===!1&&a.shiftKey===!1||!e.state.lastClickedRecord)e.deSelectAllRecords(),e.selectRecord(n),a.shiftKey===!0&&window.getSelection().removeAllRanges();else if(a.ctrlKey!==!0&&a.metaKey!==!0||a.shiftKey!==!1){if(a.shiftKey===!0){if(s=e.state.lastClickedRecord,e.state.lastClickedRecord.data("rowIndex")<n.data("rowIndex")){do{s.hasClass("isSelected")||e.selectRecord(s);var s=s.next()}while(s.data("rowIndex")<=n.data("rowIndex"))}else do s.hasClass("isSelected")||e.selectRecord(s),s=s.prev();while(s.data("rowIndex")>=n.data("rowIndex"));window.getSelection().removeAllRanges()}}else n.hasClass("isSelected")?e.deSelectRecord(n):e.selectRecord(n);e.state.lastClickedRecord=n}).contextmenu(function(a){for(var n=t(a.currentTarget),s=!0,i=0;i<window.getSelection().rangeCount;i++){var o=window.getSelection().getRangeAt(i).toString();if(o&&o.length>0){var l=t(window.getSelection().getRangeAt(i).startContainer).parents(".urlTable__row");l.data("rowIndex")===n.data("rowIndex")?s=!1:(l=t(window.getSelection().getRangeAt(i).endContainer).parents(".urlTable__row"),l.data("rowIndex")===n.data("rowIndex")&&(s=!1))}}s&&(a.preventDefault(),TYPO3.ClickMenu.show("tx_naworkuri_uri",t(this).data("uid"),"1",encodeURIComponent("+")+"show,edit,lock,unlock,delete"+(e.state.selectedRecords.length>0?",deleteSelected":""),""))})},initContextMenuEvents:function(){this.$element.on("lock",function(e,a){var n=t(this).data("urlModule");t.ajax({url:n.urls.lock,data:{tx_naworkuri_naworkuri_naworkuriuri:{url:a}},success:function(){n.loadUrls()},error:function(e,a,n){var s=top.TYPO3.Modal.confirm(tx_naworkuri_labels.title.error,tx_naworkuri_labels.message.error.format(n),top.TYPO3.Severity.error,[{text:t(this).data("button-ok-text")||top.TYPO3.lang["button.ok"]||"OK",btnClass:"btn-"+top.TYPO3.Modal.getSeverityClass(top.TYPO3.Severity.error),name:"ok"}]);s.on("confirm.button.ok",function(){top.TYPO3.Modal.dismiss()})}})}),this.$element.on("unlock",function(e,a){var n=t(this).data("urlModule");t.ajax({url:n.urls.unlock,data:{tx_naworkuri_naworkuri_naworkuriuri:{url:a}},success:function(){n.loadUrls()},error:function(e,a,n){var s=top.TYPO3.Modal.confirm(tx_naworkuri_labels.title.error,tx_naworkuri_labels.message.error.format(n),top.TYPO3.Severity.error,[{text:t(this).data("button-ok-text")||top.TYPO3.lang["button.ok"]||"OK",btnClass:"btn-"+top.TYPO3.Modal.getSeverityClass(top.TYPO3.Severity.error),name:"ok"}]);s.on("confirm.button.ok",function(){top.TYPO3.Modal.dismiss()})}})}),this.$element.on("delete",function(e,a){var n=t(this).data("urlModule"),s=n.$element.find('[data-uid="'+a+'"]').first();if(s&&1===s.length){var i=s.find(".urlTable__column--text").first();if(i&&1===i.length)var o=i.text();var l=top.TYPO3.Modal.confirm(tx_naworkuri_labels.title.delete,tx_naworkuri_labels.message.delete.format(o),top.TYPO3.Severity.warning);l.on("confirm.button.cancel",function(){top.TYPO3.Modal.dismiss()}),l.on("confirm.button.ok",function(){top.TYPO3.Modal.dismiss(),t.ajax({url:n.urls.delete,data:{tx_naworkuri_naworkuri_naworkuriuri:{url:a}},success:function(){n.loadUrls()},error:function(e,a,n){var s=top.TYPO3.Modal.confirm(tx_naworkuri_labels.title.error,tx_naworkuri_labels.message.error.format(n),top.TYPO3.Severity.error,[{text:t(this).data("button-ok-text")||top.TYPO3.lang["button.ok"]||"OK",btnClass:"btn-"+top.TYPO3.Modal.getSeverityClass(top.TYPO3.Severity.error),name:"ok"}]);s.on("confirm.button.ok",function(){top.TYPO3.Modal.dismiss()})}})})}}),this.$element.on("deleteSelected",function(){var e=t(this).data("urlModule"),a=[];t.each(e.state.selectedRecords,function(t,e){var n=e.data("uid");isNaN(n)||a.push(n)});var n=top.TYPO3.Modal.confirm(tx_naworkuri_labels.title.deleteSelected,tx_naworkuri_labels.message.deleteSelected.format(a.length),top.TYPO3.Severity.warning);n.on("confirm.button.cancel",function(){top.TYPO3.Modal.dismiss()}),n.on("confirm.button.ok",function(){top.TYPO3.Modal.dismiss(),t.ajax({url:e.urls.deleteSelected,data:{tx_naworkuri_naworkuri_naworkuriuri:{uids:a}},success:function(){e.loadUrls()},error:function(e,a,n){var s=top.TYPO3.Modal.confirm(tx_naworkuri_labels.title.error,tx_naworkuri_labels.message.error.format(n),top.TYPO3.Severity.error,[{text:t(this).data("button-ok-text")||top.TYPO3.lang["button.ok"]||"OK",btnClass:"btn-"+top.TYPO3.Modal.getSeverityClass(top.TYPO3.Severity.error),name:"ok"}]);s.on("confirm.button.ok",function(){top.TYPO3.Modal.dismiss()})}})})})},selectRecord:function(t){this.state.selectedRecords.push(t),t.addClass("isSelected")},deSelectRecord:function(e){var a=-1;t.each(this.state.selectedRecords,function(t,n){n.data("uid")==e.data("uid")&&(a=t)}),!isNaN(a)&&a>-1&&(e.removeClass("isSelected"),this.state.selectedRecords.splice(a,1))},deSelectAllRecords:function(){t.each(this.state.selectedRecords,function(t,e){e.removeClass("isSelected")}),this.state.selectedRecords.length=0},loadUrls:function(){var e=this;this.$tableInner.html('<div class="urlTable__row"><span class="urlTable__column urlTable__column--fullWidth">%s</span></div>'.format(tx_naworkuri_labels.loadingMessage)),null!==this.state.ajaxCall&&this.state.ajaxCall.readyState!==XMLHttpRequest.DONE&&this.state.ajaxCall.abort(),this.state.ajaxCall=t.getJSON(this.urls.load,{tx_naworkuri_naworkuri_naworkuriuri:{filter:this.filter}},function(t){t&&(t.html&&t.html.length>0&&(e.$tableInner.html(t.html),e.initTableRowSelect()),t.start&&t.end?e.controls.$numberOfRecords.text(tx_naworkuri_labels.numberOfRecords.format(t.start,t.end)):e.controls.$numberOfRecords.text(tx_naworkuri_labels.numberOfRecords.format(0,0)),t.page&&t.pagesMax?(e.updatePagination(t.page,t.pagesMax),t.page>1?(e.controls.$first.removeClass("disabled"),e.controls.$previous.removeClass("disabled")):(e.controls.$first.addClass("disabled"),e.controls.$previous.addClass("disabled")),t.page<t.pagesMax?(e.controls.$next.removeClass("disabled"),e.controls.$last.removeClass("disabled")):(e.controls.$next.addClass("disabled"),e.controls.$last.addClass("disabled"))):e.updatePagination(0,0))})},updatePagination:function(t,e){this.controls.$page.val(t),isNaN(e)||(this.state.maxPages=e,this.controls.$pagesMax.text(e))}},t.fn.UrlModule=function(a){return this.each(function(n,s){t(s).data("urlModule",new e(s,a))})},t(document).ready(function(){t(".urlTable").UrlModule()})}(jQuery);